# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫ —Ç–∞–π–º–∞—É—Ç–∞ –≤ Telegram –±–æ—Ç–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ë–æ—Ç –ø–æ–ª—É—á–∞–ª –æ—à–∏–±–∫—É "Timed out" –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–æ–≤, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Å–±–æ—è–º –≤ —Ä–∞–±–æ—Ç–µ.

## –ü—Ä–∏—á–∏–Ω—ã —Ç–∞–π–º–∞—É—Ç–æ–≤
1. **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - –º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã
2. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF** - —Å–ª–æ–∂–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
3. **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –±–æ–ª—å—à–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
4. **–ó–∞–ø—Ä–æ—Å—ã –∫ Telegram API** - —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤ (config.py)
```python
TIMEOUT_SETTINGS = {
    'file_download': 300,  # 5 –º–∏–Ω—É—Ç –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
    'file_upload': 300,    # 5 –º–∏–Ω—É—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
    'conversion': 600,     # 10 –º–∏–Ω—É—Ç –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
    'telegram_request': 30 # 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API
}
```

### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å —Ç–∞–π–º–∞—É—Ç–∞–º–∏ (bot.py)

#### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
```python
async def _download_file_with_timeout(self, bot, file_id: str, file_path: Path) -> bool:
    try:
        file = await asyncio.wait_for(
            bot.get_file(file_id),
            timeout=TIMEOUT_SETTINGS['telegram_request']
        )
        
        await asyncio.wait_for(
            file.download_to_drive(file_path),
            timeout=TIMEOUT_SETTINGS['file_download']
        )
        return True
    except asyncio.TimeoutError:
        logger.error(f"–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ {file_id}")
        return False
```

#### –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
```python
async def _send_file_with_timeout(self, bot, chat_id: int, file_path: Path, 
                                filename: str, caption: str) -> bool:
    try:
        with open(file_path, 'rb') as file:
            await asyncio.wait_for(
                bot.send_document(...),
                timeout=TIMEOUT_SETTINGS['file_upload']
            )
        return True
    except asyncio.TimeoutError:
        logger.error(f"–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–∞ {filename}")
        return False
```

#### –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å —Ç–∞–π–º–∞—É—Ç–æ–º
```python
async def _convert_to_word_async(self, update, context, pdf_path, file_info):
    try:
        success = await asyncio.wait_for(
            asyncio.get_event_loop().run_in_executor(
                None,
                self.converter.convert_to_word,
                str(pdf_path),
                str(output_path),
                True,  # preserve_layout
                True   # include_images
            ),
            timeout=TIMEOUT_SETTINGS['conversion']
        )
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...
    except asyncio.TimeoutError:
        await query.edit_message_text(
            "‚è∞ –ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏!\n\n"
            "–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –∏–ª–∏ —Å–ª–æ–∂–Ω—ã–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞."
        )
```

### 3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
```python
async def error_handler(self, update: Update, context: ContextTypes.DEFAULT_TYPE):
    error = context.error
    
    if isinstance(error, (TimedOut, asyncio.TimeoutError)):
        error_message = (
            "‚è∞ –û—à–∏–±–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞!\n\n"
            "–û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–Ω—è–ª–∞ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.\n"
            "–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\n"
            "‚Ä¢ –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π\n"
            "‚Ä¢ –ú–µ–¥–ª–µ–Ω–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n"
            "‚Ä¢ –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä\n\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n"
            "‚Ä¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞\n"
            "‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ\n"
            "‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç"
        )
    elif isinstance(error, NetworkError):
        error_message = (
            "üåê –û—à–∏–±–∫–∞ —Å–µ—Ç–∏!\n\n"
            "–ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º.\n"
            "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
        )
```

### 4. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ PDF –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–µ

–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ç–∞–π–º–∞—É—Ç–æ–º:
```python
async def _run_with_timeout(self, func, *args, timeout: int = 600, **kwargs):
    try:
        return await asyncio.wait_for(
            asyncio.get_event_loop().run_in_executor(None, func, *args, **kwargs),
            timeout=timeout
        )
    except asyncio.TimeoutError:
        logger.error(f"–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ {func.__name__}")
        return False
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–Ω–∏–π** - –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –±—É–¥—É—Ç –≤–∏—Å–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
2. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
3. **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - —Ç–∞–π–º–∞—É—Ç—ã –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
4. **–õ—É—á—à–∞—è –æ—Ç–ª–∞–¥–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
5. **Graceful degradation** - –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤** - —É–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã –≤ `TIMEOUT_SETTINGS`
2. **–î–ª—è –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞** - —É–≤–µ–ª–∏—á—å—Ç–µ `file_download` –∏ `file_upload`
3. **–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö PDF** - —É–≤–µ–ª–∏—á—å—Ç–µ `conversion` —Ç–∞–π–º–∞—É—Ç
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
- [ ] –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö PDF —Ñ–∞–π–ª–æ–≤
- [ ] –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é —Å–ª–æ–∂–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- [ ] –û—Ç–ø—Ä–∞–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
- [ ] –û–±—Ä–∞–±–æ—Ç–∫—É –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
